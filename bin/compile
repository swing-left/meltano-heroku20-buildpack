#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>
set -e

echo "current directory: $(pwd)"
echo "meltano binary: $(which meltano)"

BUILD_DIR=$1
echo "BUILD DIR: $BUILD_DIR"
CACHE_DIR=$2
echo "CACHE_DIR: $CACHE_DIR"
ENV_DIR=$3
echo "ENV_DIR: $ENV_DIR"

ROOT_DIR=/app

echo "heroku dir contents"
ls -la $ROOT_DIR/.heroku/
echo "heroku/python contents"
ls -la $ROOT_DIR/.heroku/python
echo "heroku/python/bin contents"
ls -la $ROOT_DIR/.heroku/python/bin

cd $BUILD_DIR/meltano

echo "-----> Installing Meltano plugins"
meltano install

meltano invoke airflow --help
