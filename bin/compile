#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>
set -e

echo "current directory: $(pwd)"
echo "meltano binary: $(which meltano)"

BUILD_DIR=$1
echo "BUILD DIR: $BUILD_DIR"
CACHE_DIR=$2
echo "CACHE_DIR: $CACHE_DIR"
ENV_DIR=$3
echo "ENV_DIR: $ENV_DIR"

ROOT_DIR=/app
PYTHONPATH= $ROOT_DIR/.heroku/python/bin/python

cd $ROOT_DIR
ls -la

echo "-----> Installing Meltano plugins"
meltano install

echo "-----> Upgrading Meltano files"
meltano upgrade files

meltano invoke airflow --help
